<div metal:use-macro="layout">
    <style type="text/css" media="screen" metal:fill-slot="css">
        
    </style>
    <div metal:fill-slot="header_buttons" style="display:inline-block;">
        <a class="inbutton" href="${request.route_url('concision.menu')}">Concision home</a>
    </div>
    <div metal:fill-slot="content">
        <script type="text/javascript" charset="utf-8">
            $(document).ready(function() {
                var $tabs = $("#query_type").tabs();
            });
        </script>
        
        <h4>Select key</h4>
        <br />
        <a href="${request.route_url('concision.query.edit_key', query_id=the_query.id)}" class="inbutton">Don't use a key</a>
        <br /><br />
        
        <table border="0" cellspacing="0" cellpadding="5">
            <div tal:repeat="(s, the_source) sources.items()">
                <div tal:condition="s in qdata['sources']">
                    
                <tr>
                    <td colspan="2" style="text-align:center;">
                        <strong>${the_source.label}</strong>
                    </td>
                </tr>
                <tr tal:repeat="c the_source.keys">
                    <td><strong>${the_source.column_labels[c]}</strong></td>
                    <td class="button_cell">
                        <a href="${request.route_url('concision.query.edit_key', query_id=the_query.id)}?key=${s}.${c}"
                            class="inbutton">Select as key</a>
                    </td>
                    <td>
                        &nbsp;
                        <span tal:condition="c == existing_key">Currently selected</span>
                    </td>
                </tr>
                </div>
            </div>
        </table>
    </div>
    
    
</div>